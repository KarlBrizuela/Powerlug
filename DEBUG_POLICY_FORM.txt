<?php

// This is a quick test script to verify the policy form submission is working
// Run this from the browser: http://localhost/powerlug/public/test-policy

use App\Models\Policy;
use Illuminate\Http\Request;

try {
    // Test 1: Check if database connection works
    echo "✓ Database connection works\n";
    
    // Test 2: Try to create a test policy record manually
    $testPolicy = Policy::create([
        'policy_number' => 'TEST-' . uniqid(),
        'client_name' => 'Test Client',
        'email' => 'test@example.com',
        'created_by' => 1,
    ]);
    
    echo "✓ Test policy created with ID: " . $testPolicy->id . "\n";
    
    // Test 3: Retrieve the policy
    $policy = Policy::find($testPolicy->id);
    echo "✓ Policy retrieved: " . $policy->policy_number . "\n";
    
    // Test 4: Delete the test record
    $testPolicy->delete();
    echo "✓ Test policy deleted\n";
    
    echo "\n✅ All tests passed! Database is working correctly.\n";
    echo "If your form is not saving, check:\n";
    echo "1. Form has correct @csrf token\n";
    echo "2. Form posts to route('policies.store')\n";
    echo "3. Policy number field is unique\n";
    echo "4. Check browser console for JavaScript errors\n";
    echo "5. Verify form data in Network tab of Developer Tools\n";
    
} catch (\Exception $e) {
    echo "❌ Error: " . $e->getMessage() . "\n";
}
